(function(){define(["module","jquery","rollbar","lib/environment","lib/promises"],function(t,e,n,i,r){var o,a,s,l;return l=0,a={},s={},require(["underscore"],function(){}),o=function(){function o(){var t;t=l++,this._initializedDataKey="initializer_initialized_"+t,this._deferredDataKey="initializer_deferred_"+t}return o.instance=function(){return this._instance||(this._instance=new o)},o.promiseFor=function(t){return this.instance().promiseFor(t)},o["with"]=function(t,n){return e(t).each(function(){return o.instance().promiseFor(this).done(n)})},o.prototype.selector=function(){return"."+t.config().root_class+"."+t.config().javascript_module_exists_class},o.prototype.initializerFor=function(r){var o,l,u,c,d,p;return u=e(r).data(t.config().template_name_data_key),null==u?(c=e(r)[0].tagName,"body"!==(null!=c?c.toLowerCase():void 0)&&(p="Could not get template name for "+e(r)[0].tagName+"."+(e(r).attr("class")||"").split(" ").join("."),i.isDevelopment()&&("undefined"!=typeof console&&null!==console&&console.warn(p),"undefined"!=typeof console&&null!==console&&console.warn(r)),n.warn(p)),function(){}):(d=u.split("/"),l=d.pop(),o=d.join("/"),null==a[o]&&(a[o]=e.Deferred(),require(["controllers/"+o],function(t){return a[o].resolve(t)})),s[u]||(s[u]=e.Deferred(),a[o].done(function(t){return s[u].resolve("function"==typeof t[l]?t[l]:void 0)})),s[u])},o.prototype._deferred=function(t){var n;if(n=e(t),1!==n.length)throw new Error("Single element expected");if(!n.is(this.selector()))throw new Error("Partial root expected (got "+n[0].tagName+"."+(n.attr("class")||"").split(" ").join(".")+")");return null==n.data(this._deferredDataKey)&&n.data(this._deferredDataKey,e.Deferred()),n.data(this._deferredDataKey)},o.prototype.promiseFor=function(t){return this._deferred(t).promise()},o.prototype.scan=function(){var n;return n=this,e(this.selector()).filter(function(){return!e(this).data(n._initializedDataKey)}).each(function(){var o;return o=e(this),function(o){return function(a){var s;return s=function(n,r){var o;return null==r&&(r=a),o=e(r).find(n),i.isDevelopment()&&o.each(function(){var i,r;return i=e(this).closest("."+t.config().root_class),e(this).hasClass(t.config().root_class)||null!=i[0]&&i[0]===a[0]?!0:(r=i.data(t.config().template_name_data_key),"undefined"!=typeof console&&null!==console&&(console.warn("Unauthorized access (using $$) from "+a.data(t.config().template_name_data_key)+" to "+r+". Accessor:"),console.warn(a[0]),console.warn("Accessing:"),console.warn(this),console.warn("Selector:"),console.warn(n)),!1)}),o},a.data(n._initializedDataKey,!0),e.when(n.initializerFor(a)).done(function(t){return r.mimicPromise(e.when(null!=t?t.call(o,s,a):void 0),n._deferred(a))})}}(this)(o)}),this},o.prototype._handleMutation=function(t,n){var i,r,o,a,s,l;for(o=this,i=!1,l=[],r=0,a=t.length;a>r;r++){if(s=t[r],e(s.addedNodes).each(function(){return e(this).is(o.selector())||e(this).find(o.selector()).length>0?(i=!0,!1):!0}),i){n();break}l.push(void 0)}return l},o.prototype.listen=function(r){if(null==r&&(r={}),this._listening)throw new Error("Already listening");return this._listening=!0,require(["underscore"],function(o){return function(a){var s;return r=a.defaults(r,{forcePoll:!1,pollInterval:2e3,pollDelay:100,throttleWait:200}),s=a.throttle(function(){return o.scan()},r.throttleWait),r.forcePoll||null==window.MutationObserver&&null==window.WebKitMutationObserver?(o._pollHandler=function(){return a.delay(s,r.pollDelay)},e(document).ajaxComplete(o._pollHandler),o._pollHandler.intervalId=setInterval(o._pollHandler,r.pollInterval)):(o._observer=new(window.MutationObserver||window.WebKitMutationObserver)(function(t){return o._handleMutation(t,s)}),o._observer.observe(e("body")[0],{childList:!0,subtree:!0})),s(),o._debugIntervalId=setInterval(function(){var r;return r=o,e(o.selector()).each(function(){return e(this).data(r._initializedDataKey)?void 0:a.delay(function(o){return function(){var a;return e(o).data(r._initializedDataKey)||!e.contains(document.documentElement,o)||e(o).data("initializer_already_warned")?void 0:(e(o).data("initializer_already_warned",!0),a="Uninitialized template in DOM: "+e(o).data(t.config().template_name_data_key)+" ("+o.tagName+"."+(e(o).attr("class")||"").split(" ").join(".")+")",i.isDevelopment()&&("undefined"!=typeof console&&null!==console&&console.warn(a),"undefined"!=typeof console&&null!==console&&console.warn(o)),n.warn(a))}}(this),2e3)})},5e3)}}(this)),this},o.prototype.stopListening=function(){var t;return null!=(t=this._observer)&&t.disconnect(),this._observer=null,null!=this._pollHandler&&(e(document).off("ajaxComplete",this._pollHandler),clearInterval(this._pollHandler.intervalId),this._pollHandler=null),null!=this._debugIntervalId?clearInterval(this._debugIntervalId):void 0},o.prototype.makeInitializable=function(n,i){return e(n).addClass(t.config().javascript_module_exists_class).data(t.config().template_name_data_key,i)},o}()})}).call(this);