<div class="container">
  <div clas="row">
    <div class="col-sm-12">
      <h1>Search Bar</h1>
    </div>
  </div>

  <div class="row search-bar">
    <div class="col-sm-12 col-lg-4">
      <p>Song Title</p>
      <input id="song" type="text"></input>
    </div>

    <div class="col-sm-12 col-lg-4">
      <p>Album Title</p>
      <input id="album" type="text"></input>
    </div>

    <div class="col-sm-12 col-lg-4">
      <p>Artist Name</p>
      <input id="artist" type="text"></input>
    </div>
  </div>

  <div class="row">
    <div class="col-sm-12">
      <table class="table table-striped table-bordered">
        <thead>
          <tr>
            <td>Song</td>
            <td>Album</td>
            <td>Artist</td>
          </tr>
        </thead>
        <tbody id="results">
        </tbody>
      </table>
    </div>
  </div>
</div>

<script>
  var songIdsFromSongTitle = []
  var songIdsFromAlbumTitle = []
  var songIdsFromArtistName = []
  var songTitleSort = false
  var albumTitleSort = false
  var artistNameSort = false

  var updateSongResults = function() {

    // var allSongsIds = new Array(0)

    // // if (songTitleSort) {
    // //   $.each(songIdsFromSongTitle, function(index,val){
    // //     allSongsIds.push(val);
    // //   });
    // // }

    // // // if (albumTitleSort) {
    // // //   $.each(songIdsFromAlbumTitle, function(index,val){
    // // //     allSongsIds.push(val);
    // // //   });
    // // // }

    // // if (artistNameSort) {
    // //   $.each(songIdsFromArtistName, function(index,val){
    // //     allSongsIds.push(val);
    // //   });
    // // }

    // // console.log('songTitleSort', songTitleSort);
    // // console.log('albumTitleSort', albumTitleSort);
    // // console.log('artistNameSort', artistNameSort);
    // // console.log('before Ajax', allSongsIds);

    // // var uniqueSongIds = Array.from(new Set(allSongsIds));

    $.ajax({
      url: "/search/",
      method: 'post',
      data: {
        'songIdsFromSongTitle': songIdsFromSongTitle,
        'songIdsFromAlbumTitle': songIdsFromAlbumTitle,
        'songIdsFromArtistName': songIdsFromArtistName,
        'songTitleSort': songTitleSort,
        'albumTitleSort': albumTitleSort,
        'artistNameSort': artistNameSort,
      },
      success: function(data) {
        console.log('data', data)
        updateTableWithResults(data);
      }
    });
  }

  var updateTableWithResults = function(data) {
    clearTable();
    $.each(data, function(index,element) { 
      $('#results')
        .append('<tr>' +
                  '<td>' + element["song"] + '</td>' +
                  '<td>' + element["album"] + '</td>' +
                  '<td>' + element["artist"] + '</td>' +
                '</tr>'
        );
    });
  }

  var clearTable = function(){
    $('#results').html('<tr></tr>')
  }

  // var searchBySong = function(query){
  //   $.ajax({
  //     url: "/songs/" + query,
  //     success: function(data) {
  //       songIdsFromSongTitle = data;
  //       updateSongResults();
  //     }
  //   });  
  //   console.log('songIdsFromSongTitle', songIdsFromSongTitle)
  // }

  // var searchByAlbum = function(query){
  //   $.ajax({
  //     url: "/albums/" + query,
  //     success: function(data) {
  //       // Array of arrays (albums have many songs) must be flattend with reduce
  //       if (data.length != 0) {
  //         songIdsFromAlbumTitle = data.reduce(function(a, b) {
  //           return a.concat(b);
  //         });
  //       }
  //       updateSongResults();
  //     }
  //   }); 
  //   console.log('albumSongIds', songIdsFromAlbumTitle);
  // }

  // var searchByArtist = function(query){
  //   $.ajax({
  //     url: "/artists/" + query,
  //     success: function(data) {
  //       // Array of arrays (artists have many songs) must be flattend with reduce
  //       if (data.length != 0) {
  //         songIdsFromArtistName = data.reduce(function(a, b) {
  //           return a.concat(b);
  //         });
  //       }
  //       updateSongResults();
  //     }
  //   }); 
  //   console.log('songIdsFromArtistName', songIdsFromArtistName);
  // }

 // Event Listeners for Three Search Inputs (Song, Album, Artist)
 // TODO(JT) - could be DRYed up

  $('#song').on('keyup', function(event) {
    query = event.target.value;
    if (query.length > 2) {
      songTitleSort = true;
      searchBySong(query);
    } else {
      songTitleSort = false
      clearTable();
    }
  });

  $('#album').on('keyup', function(event) {
    query = event.target.value;
    if (query.length > 2) {
      albumTitleSort = true;
      searchByAlbum(query);
    } else {
      albumTitleSort = false;
      clearTable();
    }
  });

  $('#artist').on('keyup', function(event) {
    query = event.target.value;
    if (query.length > 2) {
      artistNameSort = true;
      searchByArtist(query);
    } else {
      artistNameSort = false;
      clearTable();
    }
  });

</script>